(this.webpackJsonpcuemein=this.webpackJsonpcuemein||[]).push([[0],{206:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),c=a(90),i=a.n(c),r=(a(97),a(98),a(99),a(20)),l=a.n(r),s=a(28),m=a(7),u=a(207),d=a(208),f=a(209),b=a(210),p=(a(24),function(e){var t=e.username,a=e.handleUsernameChange,n=e.roomName,c=e.handleRoomNameChange,i=e.handleSubmit;return o.a.createElement(u.a,{className:"controlpanel",fluid:!0},o.a.createElement(d.a,{className:"cmilogo"},o.a.createElement("img",{src:"/cuemeinlogo.png",width:"400",height:"400"})),o.a.createElement(d.a,{className:"control"},o.a.createElement(f.a,{onSubmit:i},o.a.createElement(f.a.Label,{className:"meeting"},"Join a Meeting"),o.a.createElement(f.a.Group,null,o.a.createElement(f.a.Label,{className:"name"},"Name:"),o.a.createElement(f.a.Control,{className:"inputname",size:"lg",type:"name",value:t,onChange:a,placeholder:"User ID"})),o.a.createElement(f.a.Group,null,o.a.createElement(f.a.Label,{className:"meetingname"},"Meeting name:"),o.a.createElement(f.a.Control,{className:"inputmeetingname",size:"lg",type:"meetingname",value:n,onChange:c,placeholder:"Room Name"})),o.a.createElement(b.a,{variant:"success",type:"submit"},"JOIN"))))}),E=a(15),v=a(40),h=a.n(v),g=a(9),N=a(10),j=a(89),k=(j.muteYourAudio,j.unmuteYourAudio,function(e){var t=e.user,a=(e.mute,e.local),c=void 0===a?"":a,i=Object(n.useState)([]),r=Object(m.a)(i,2),l=r[0],s=r[1],u=Object(n.useState)([]),d=Object(m.a)(u,2),f=d[0],b=d[1],p=Object(n.useState)(!1),v=Object(m.a)(p,2),h=v[0],j=v[1],k=Object(n.useState)(!1),O=Object(m.a)(k,2),y=O[0],S=O[1],C=Object(n.useState)(""),w=Object(m.a)(C,2),T=(w[0],w[1],Object(n.useRef)()),R=Object(n.useRef)(),P="black-box";console.log("User.js",t.identity);var A=function(e){j(e),console.log("toggle mute",e)},x=function(e){console.log("toggleVmute",e),S(e)},D=function(e){return Array.from(e.values()).map((function(e){return e.track})).filter((function(e){return null!==e}))};function I(e,t){var a,n,o=document.getElementById(t);o.innerHTML=e,a=o,n="appear",setTimeout((function(){a.classList.remove(n)}),5e3),a.classList.add(n)}return Object(n.useEffect)((function(){s(D(t.videoTracks)),b(D(t.audioTracks)),t.videoTracks.forEach((function(e){e.on("trackEnabled",x.bind(void 0,!1)),e.on("trackDisabled",x.bind(void 0,!0))})),t.audioTracks.forEach((function(e){e.on("trackEnabled",A.bind(void 0,!1)),e.on("trackDisabled",A.bind(void 0,!0))}));return t.on("trackSubscribed",(function(e){console.log(e,"track subs"),"video"===e.kind?(S(!e.isEnabled),s((function(t){return[].concat(Object(E.a)(t),[e])}))):"audio"===e.kind?(j(!e.isEnabled),b((function(t){return[].concat(Object(E.a)(t),[e])}))):"data"==e.kind&&(e.on("message",(function(t){console.log("DATA REACTION"),console.log(JSON.parse(t).emojiData,e.sid),console.log(JSON.parse(t).user,"reaction id"),function(e,t){console.log(e);var a=document.getElementById(e);console.log(a,"user.id DIV");var n=document.createElement("div");n.setAttribute("id",t.sid),n.setAttribute("class","emoji"),a.appendChild(n)}(JSON.parse(t).user,e),I(JSON.parse(t).emojiData,e.sid)})),console.log("TRACK"),console.log("TRACK",e))})),t.on("trackUnsubscribed",(function(e){"video"===e.kind?s((function(t){return t.filter((function(t){return t!==e}))})):"audio"===e.kind&&b((function(t){return t.filter((function(t){return t!==e}))}))})),function(){s([]),b([]),t.removeAllListeners()}}),[t]),Object(n.useEffect)((function(){var e=l[0];if(e)return console.log("User.js attach()",t.identity),e.attach(T.current),function(){console.log("User.js detach()",t.identity),e.detach()}}),[l]),Object(n.useEffect)((function(){var e=f[0];if(e)return e.attach(R.current),function(){e.detach()}}),[f]),P="i"===c?"participant-video-emptyi":"participant-video-empty",o.a.createElement("div",{className:"user-camera"},o.a.createElement("div",{id:t.sid,className:"user-camera-reaction"}),o.a.createElement("div",{className:"user-camera-box"},y?o.a.createElement("div",{className:"black-box"},"fds"):"",y?o.a.createElement(g.a,{className:"empty-icon-video",icon:N.b,size:"2x"}):"",y?o.a.createElement("video",{className:P,width:"100%",ref:T}):o.a.createElement("video",{className:"participant-video",width:"100%",ref:T,autoPlay:!0})),o.a.createElement("div",{className:"participant-border"},o.a.createElement("div",{className:"participant-border-name"},t.identity),h?o.a.createElement("div",{className:"muted-bg"},o.a.createElement(g.a,{className:"muted",icon:N.j,size:"1x"})):""),o.a.createElement("audio",{ref:R,autoPlay:!0,muted:!0}))}),O=function(e){var t=e.room,a=Object(n.useState)([]),c=Object(m.a)(a,2),i=c[0],r=c[1],u=Object(n.useState)([]),f=Object(m.a)(u,2),b=f[0],p=f[1],v=Object(n.useState)("-"),h=Object(m.a)(v,2),j=h[0],k=h[1],O=Object(n.useState)("participant-video"),y=Object(m.a)(O,2),S=(y[0],y[1],Object(n.useState)(null)),C=Object(m.a)(S,2),w=C[0],T=C[1],R=Object(n.useRef)();Object(n.useRef)();Object(n.useEffect)((function(){null!==t&&t.on("dominantSpeakerChanged",(function(e){T(e),console.log("new dominant speaker Dominant.js")}))}),[t]);var P=function(e){return Array.from(e.values()).map((function(e){return e.track})).filter((function(e){return null!==e}))};Object(n.useEffect)((function(){if(null!=w){r(P(w.videoTracks)),p(P(w.audioTracks));return w.on("trackSubscribed",(function(e){"video"===e.kind?r((function(t){return[].concat(Object(E.a)(t),[e])})):"audio"===e.kind?p((function(t){return[].concat(Object(E.a)(t),[e])})):"data"==e.kind&&e.on("message",(function(e){console.log(JSON.parse(e).user,JSON.parse(e).emojiData,JSON.parse(e).identity,"Dominant-REACTION")}))})),w.on("trackUnsubscribed",(function(e){"video"===e.kind?r((function(t){return t.filter((function(t){return t!==e}))})):"audio"===e.kind&&p((function(t){return t.filter((function(t){return t!==e}))}))})),function(){r([]),p([]),w.removeAllListeners()}}}),[w]);var A,x,D=function(){var e=Object(s.a)(l.a.mark((function e(){var a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="/emotion?identity="+w.identity+"&room="+t.name,e.next=3,fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()}));case 3:n=e.sent,k(n);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),I=function(e,t){var a=new MediaRecorder(e),n=[];a.ondataavailable=function(e){return n.push(e.data)},a.start();var o,c=new Promise((function(e,t){a.onstop=e,a.onerror=function(e){return t(e.name)}})),i=(o=t,new Promise((function(e){return setTimeout(e,o)}))).then((function(){return"recording"==a.state&&a.stop()}));return Promise.all([c,i]).then((function(){return n}))};return Object(n.useEffect)((function(){if(null!=w){var e=i[0];e&&e.attach(R.current)}}),[i]),Object(n.useEffect)((function(){var e=setInterval((function(){if(null!=w&&i[0].isEnabled){var e=i[0];e&&(a=e.mediaStreamTrack,new ImageCapture(a).grabFrame().then((function(e){var a=document.createElement("canvas");a.width=e.width,a.height=e.height,a.getContext("2d").drawImage(e,0,0),a.toBlob((function(e){var a=new FileReader;a.addEventListener("loadend",(function(){fetch(a.result).then((function(e){return e.blob()})).then((function(e){var a="/video/snapShot?identity="+w.identity+"&room="+t.name;fetch(a,{method:"POST",body:e,headers:{"Content-Type":"application/octet-stream"}}).then((function(){D()}))}))})),a.readAsDataURL(e)}),"image/jpeg")})).catch((function(e){console.log("takePhoto() error: ",e)})))}var a}),2e3);return function(){clearInterval(e)}}),[i]),Object(n.useEffect)((function(){var e=setInterval((function(){if(console.log("New function called"),null!=w&&!i[0].isEnabled){var e=b[0];e&&function(e,a){var n=new MediaStream;n.addTrack(e);new MediaRecorder(n);navigator.mediaDevices.getUserMedia({audio:!0}).then((function(){return I(n,a)})).then((function(e){var a=new Blob(e,{type:"application/octet-stream"}),n=new FileReader;n.addEventListener("loadend",(function(){fetch(n.result).then((function(e){return e.blob()})).then((function(e){var a="/audio/snapShot?identity="+w.identity+"&room="+t.name;fetch(a,{method:"POST",body:e,headers:{"Content-Type":"application/octet-stream"}}).then((function(){D()}))}))})),n.readAsDataURL(a)}))}(e.mediaStreamTrack,1e4)}}),1e4);return function(){clearInterval(e)}}),[b]),"happiness"===j.emotion?(A=o.a.createElement(g.a,{className:"dominant-emotion-happy emotion",icon:N.f,size:"2x"}),x="HAPPY"):"anger"===j.emotion?(A=o.a.createElement(g.a,{className:"dominant-emotion-angry emotion",icon:N.a,size:"2x"}),x="ANGRY"):"sadness"===j.emotion?(A=o.a.createElement(g.a,{className:"dominant-emotion-sadness emotion",icon:N.k,size:"2x"}),x="SADNESS"):"fear"===j.emotion?(A=o.a.createElement(g.a,{className:"dominant-emotion-fear emotion",icon:N.c,size:"2x"}),x="FEAR"):"disgust"===j.emotion?(A=o.a.createElement(g.a,{className:"dominant-emotion-disgust emotion",icon:N.m,size:"2x"}),x="DISGUST"):"neutral"===j.emotion?(A=o.a.createElement(g.a,{className:"dominant-emotion-neutral emotion",icon:N.g,size:"2x"}),x="NEUTRAL"):"surprise"===j.emotion?(A=o.a.createElement(g.a,{className:"dominant-emotion-surprised emotion",icon:N.d,size:"2x"}),x="SURPRISE"):"-"===j.emotion&&(A=o.a.createElement(g.a,{className:"dominant-emotion-undefined emotion",icon:N.h,size:"2x"}),x="UNDEFINED"),o.a.createElement(d.a,{className:"dominant-camera"},o.a.createElement("div",{id:"das",className:"dominant-camera-reaction"}),w?o.a.createElement("video",{className:"participant-video-dominant",width:"100%",height:"100%",ref:R,autoPlay:!0}):o.a.createElement("div",{className:"default-video-dominant"},o.a.createElement(g.a,{className:"dominant-camera-default",icon:N.n,size:"2x"})),o.a.createElement("div",{className:"dominant-border-emotion-icon"},o.a.createElement("h3",{className:"dominant-border-emotion-header"},"Emotion"),o.a.createElement("div",{className:"dominant-icon"},A)),o.a.createElement("div",{className:"dominant-border"},w?o.a.createElement("div",{className:"dominant-border-name"},w.identity):"",o.a.createElement("div",{className:"dominant-border-emotion-background"},o.a.createElement("div",{className:"dominant-border-emotion-text"},x))))},y=a(91),S=function(e){var t,c,i=e.meetingname,r=e.token,l=(e.emotion,e.logout),s=(e.test,Object(n.useState)(null)),f=Object(m.a)(s,2),b=f[0],p=f[1],v=Object(n.useState)([]),j=Object(m.a)(v,2),S=j[0],C=j[1],w=Object(n.useState)(""),T=Object(m.a)(w,2),R=T[0],P=T[1],A=Object(n.useState)(!1),x=Object(m.a)(A,2),D=x[0],I=x[1],L=Object(n.useState)(!1),z=Object(m.a)(L,2),U=z[0],M=z[1],Y=Object(n.useState)(!1),J=Object(m.a)(Y,2),B=J[0],F=J[1],G=a(89),V=G.muteYourAudio,H=G.unmuteYourAudio,K=a(40).LocalDataTrack;console.log("Room.js render");var q=function(e,t){if(!e.localParticipant.videoTracks.entries().next()){var a=e.localParticipant.videoTracks.entries().next().value[1].track.mediaStreamTrack;new ImageCapture(a).grabFrame().then((function(t){console.log("bitmap :",t);var a=document.createElement("canvas");a.width=t.width,a.height=t.height,a.getContext("2d").drawImage(t,0,0),a.toBlob((function(t){var a=new FileReader;a.addEventListener("loadend",(function(){fetch(a.result).then((function(e){return e.blob()})).then((function(t){fetch("/video/snapShot?identity="+e.localParticipant.identity+"&room="+e.name,{method:"POST",body:t,headers:{"Content-Type":"application/octet-stream"}})}))})),a.readAsDataURL(t)}),"image/jpeg")})).catch((function(e){console.log("takePhoto() error: ",e)}))}},Q=function(e){console.log(e),e.forEach((function(e){fetch("/video/emotion?identity="+e.identity+"&room="+b.name,{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(t){e.emotion=t.body.emotion}))}))},W=function(e){c&&window.clearInterval(c),c=window.setInterval(Q,1e4,e)};Object(n.useEffect)((function(){console.log("dominant speacjer Room.js effect");var e,a=function(e){console.log("Room.js - particiapnt connected",e),C((function(t){return[].concat(Object(E.a)(t),[e])})),W(S)},n=function(e){console.log("Room.js - particiapnt disconnected",e,S),C((function(t){return t.filter((function(t){return t!==e}))})),W(S),console.log(S)},o=function(e){null!==e?P(e.identity):null===e&&P(null)},c=function(e,t){};function l(e){var t,a,n=document.getElementById("datalocal");n.innerHTML=e,t=n,a="appear",setTimeout((function(){t.classList.remove(a)}),1e3),t.classList.add(a)}function s(t){var a=t.target.innerHTML;l(a),p((function(t){var n,o,c;return console.log("id",t),n=a,o=t.localParticipant.sid,c=t.identity,e.send(JSON.stringify({emojiData:n,user:o,identity:c})),t})),console.log("id",b,"fdsafsadas")}return function(){for(var e=document.getElementsByClassName("emojibuttons"),t=0;t<e.length;t++)e[t].addEventListener("click",s)}(),function(){var t=new K;e=t}(),h.a.connect(r,{name:i,dominantSpeaker:!0,audio:!0,video:!0}).then((function(i){console.log("Room.js - line 59 - video.connect",i),p(i),i.on("participantConnected",a),i.on("participantDisconnected",n),i.on("dominantSpeakerChanged",o),i.on("trackDisabled",c),i.localParticipant.publishTrack(e),i.participants.forEach(a),t=window.setInterval(q,5e4,i,S)})),function(){t&&window.clearInterval(t),p((function(e){return e&&"connected"===e.localParticipant.state?(e.localParticipant.tracks.forEach((function(e){e.track.stop()})),console.log("disconnect!!!!!!"),e.disconnect(),null):e}))}}),[i,r]);var X=Object(n.useCallback)((function(){console.log("called mutecallback, button pressed"),!1===D&&null!==b?(G.muteYourAudio(b),I(!0)):!0===D&&null!==b&&(G.unmuteYourAudio(b),I(!1))}),[D,b]),Z=Object(n.useCallback)((function(){console.log("called mutevideocallback, button pressed"),!1===U&&null!==b?(G.muteYourVideo(b),M(!0)):!0===U&&null!==b&&(G.unmuteYourVideo(b),M(!1))}),[U,b]),$=Object(n.useCallback)((function(){console.log("called deafencallback, button pressed"),!1===B&&null!==b?(V(b),F(!0)):!0===B&&null!=b&&(H(b),F(!1))}),[b,B]),_=Object(n.useCallback)((function(){console.log("testing - line 125!!!!!!",b),b&&"connected"===b.localParticipant.state&&(b.localParticipant.tracks.forEach((function(e){"video"!=e.track.kind&&"audio"!=e.track.kind||e.track.stop()})),b.disconnect()),l()}),[b]),ee=S.map((function(e,t){return o.a.createElement(k,{key:t,user:e,mute:B})}));return o.a.createElement("div",{className:"room"},o.a.createElement(u.a,{className:"cameras",fluid:"true"},o.a.createElement(d.a,{className:"cameras-row"},o.a.createElement(y.a,{sm:2,className:"local-participant"},b?o.a.createElement("div",{className:"local-participant-camera"},o.a.createElement(k,{key:b.localParticipant.sid,user:b.localParticipant,mute:B,local:"i"}),o.a.createElement("div",{id:"datalocal",className:"emoji"})):"",o.a.createElement("div",{className:"remote-participants"},ee)),o.a.createElement(y.a,{sm:10,className:"dominant"},o.a.createElement(O,{className:"dominant-user",key:"dominant",room:b}),o.a.createElement("div",{className:"dominant-header-bg"},o.a.createElement("div",{className:"dominant-header"},o.a.createElement("div",{className:"dominant-header-room"},"Room Name: ",i),o.a.createElement("div",{className:"dominant-header-speaker"},"Talking: ",R)))))),o.a.createElement(u.a,{fluid:"true"},o.a.createElement("div",{className:"toolbar"},o.a.createElement("div",{className:"toolbar-items"},o.a.createElement("div",{className:"logoutbutton"},o.a.createElement("button",{className:"logoutbutton-btn danger",onClick:_},"LOG OUT")),o.a.createElement("div",{className:"btns-toolbar"},o.a.createElement("div",{className:"col-audio"},D?o.a.createElement("button",{className:"btn1 info",onClick:X},o.a.createElement("span",{className:"btn2"},"Mute"),o.a.createElement(g.a,{className:"btnsize",icon:N.j})):o.a.createElement("button",{className:"btn1 info",onClick:X},o.a.createElement("span",{className:"btn2"},"Mute"),o.a.createElement(g.a,{className:"btnsize",icon:N.i}))),o.a.createElement("div",{className:"col-video"},U?o.a.createElement("button",{className:"btn1 info",onClick:Z},o.a.createElement("span",{className:"btn2"},"Camera"),o.a.createElement(g.a,{className:"btnsize",icon:N.p})):o.a.createElement("button",{className:"btn1 info",onClick:Z},o.a.createElement("span",{className:"btn2"},"Camera"),o.a.createElement(g.a,{className:"btnsize",icon:N.o}))),o.a.createElement("div",{className:"col-silence"},B?o.a.createElement("button",{className:"btn1 info",onClick:$},o.a.createElement("span",{className:"btn2"},"Silence"),o.a.createElement(g.a,{className:"btnsize",icon:N.l})):o.a.createElement("button",{className:"btn1 info",onClick:$},o.a.createElement("span",{className:"btn2"},"Silence"),o.a.createElement(g.a,{className:"btnsize",icon:N.e})))),o.a.createElement("div",{className:"col-emoji"},o.a.createElement("div",{className:"emojiPanel",style:{padding:"1rem"}},o.a.createElement("div",{className:"reaction-container"},o.a.createElement("span",{className:"reaction-label-like"},"Like"),o.a.createElement("button",{id:"emoji-wink",className:"btn3 warning emojibuttons",style:{marginRight:"1rem"}},o.a.createElement("span",{className:"reaction-entity"},"\ud83d\udc4d"))),o.a.createElement("div",{className:"reaction-container"},o.a.createElement("span",{className:"reaction-label-dislike"},"Dislike"),o.a.createElement("button",{id:"emoji-eyes",className:"btn3 warning emojibuttons",style:{marginRight:"1rem"}},o.a.createElement("span",{className:"reaction-entity"},"\ud83d\udc4e"))),o.a.createElement("div",{className:"reaction-container"},o.a.createElement("span",{className:"reaction-label-love"},"Love"),o.a.createElement("button",{id:"emoji-heart",className:"btn3 warning emojibuttons",style:{marginRight:"1rem"}},o.a.createElement("span",{className:"reaction-entity"},"\u2764")))))))))},C=function(){var e=Object(n.useState)(""),t=Object(m.a)(e,2),a=t[0],c=t[1],i=Object(n.useState)(""),r=Object(m.a)(i,2),u=r[0],d=r[1],f=Object(n.useState)(null),b=Object(m.a)(f,2),E=b[0],v=b[1],h=Object(n.useCallback)((function(e){d(e.target.value)}),[]),g=Object(n.useCallback)((function(e){c(e.target.value)}),[]),N=Object(n.useCallback)(function(){var e=Object(s.a)(l.a.mark((function e(t){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.next=3,fetch("/video/token",{method:"POST",body:JSON.stringify({identity:a,room:u}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()}));case 3:n=e.sent,v(n.token);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[u,a]),j=Object(n.useCallback)((function(e){v(null)}),[]);return E?o.a.createElement(S,{meetingname:u,token:E,logout:j}):o.a.createElement(p,{username:a,roomName:u,handleUsernameChange:g,handleRoomNameChange:h,handleSubmit:N})};var w=function(){return o.a.createElement("div",null,o.a.createElement(C,null))};i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(w,null)),document.getElementById("body"))},89:function(e,t){function a(e,t,a){("audio"===t?e.localParticipant.audioTracks:e.localParticipant.videoTracks).forEach((function(e){"mute"===a?(console.log("disable local audio"),e.track.disable()):e.track.enable()}))}t.muteYourAudio=function(e){a(e,"audio","mute")},t.muteYourVideo=function(e){a(e,"video","mute")},t.unmuteYourAudio=function(e){a(e,"audio","unmute")},t.unmuteYourVideo=function(e){a(e,"video","unmute")},t.participantMutedOrUnmutedMedia=function(e,t,a){e.on("trackSubscribed",(function(e,n,o){e.on("disabled",(function(){return t(e,o)})),e.on("enabled",(function(){return a(e,o)}))}))}},92:function(e,t,a){e.exports=a(206)},97:function(e,t,a){},98:function(e,t,a){},99:function(e,t,a){}},[[92,1,2]]]);
//# sourceMappingURL=main.1a58bd73.chunk.js.map